
### 矩阵

#### 齐次坐标
为了使得矩阵运算能够将位移（T）与旋转（R）、缩放（S）进行统一处理，引入齐次坐标。

#### 旋转矩阵
绕 x 轴旋转 $\alpha$ 角
$$
R_x(\alpha)=
\begin{bmatrix}
1&0&0\\
0&\cos\alpha&-sin\alpha\\
0&\sin\alpha&\cos\alpha
\end{bmatrix}
$$
绕 y 轴旋转 $\alpha$ 角
$$
R_y(\alpha)=
\begin{bmatrix}
\cos\alpha&0&\sin\alpha\\
0&1&0\\
-\sin\alpha&0&\cos\alpha
\end{bmatrix}
$$
绕 z 轴旋转 $\alpha$ 角
$$
R_z(\alpha)=
\begin{bmatrix}
\cos\alpha&-\sin\alpha&0\\
\sin\alpha&\cos\alpha&0\\
0&0&1
\end{bmatrix}
$$

#### 万向锁

$$
R_xyz(\alpha,\beta,\gamma) = R_z(\gamma)R_y(\beta)R_x(\alpha)
$$
初始：物体局部坐标系三轴方向与世界坐标系三轴同向
特定角度变换后：物体局部坐标系中的 a 轴与世界坐标系 b 轴同向。
假设此时是物体局部坐标系中的 x 轴与世界坐标系 z 轴同向，则此时修改 $\alpha$ 绕世界坐标系 x 轴旋转，其效果等同于绕物体局部坐标系 z 轴旋转。

#### 缩放矩阵

$$
S(s_x,s_y,s_z)=
\begin{bmatrix}
s_x&0&0\\
0&s_y&0\\
0&0&s_z
\end{bmatrix}
$$

#### 位移矩阵

利用点的齐次坐标 (x,y,z,w) 中 w 为 1，使之加上齐次坐标下的第四列向量。
$$
\begin{bmatrix}
1&0&0&t_x\\
0&1&0&t_y\\
0&0&1&t_z\\
0&0&0&1\\
\end{bmatrix}
\begin{pmatrix}
x\\y\\z\\1
\end{pmatrix}
=
\begin{pmatrix}
x+t_x\\y+t_y\\z++t_z\\1
\end{pmatrix}
$$

### 变换

#### 模型变换
将模型放置到世界空间。
模型的局部坐标变换为世界坐标。
#### 视角变换
模型的世界坐标变换为相机局部坐标系下的坐标
#### 投影变换
使观察空间中的坐标可投影到2D屏幕。
但注意，仍保留了 z 坐标深度信息。

正交投影变换：选择的视锥体为长方体
透视投影变换：选择的视锥体为四棱台。
#### 视口变换
NDC 坐标映射到 2D 屏幕上的像素坐标。

### 空间
#### 世界空间
默认的坐标系。
#### 模型空间
模型自身的局部坐标系
#### 观察空间
设相机在世界空间中位于 $\vec{e}$ ，面朝 $\vec{g}$，头顶方向 $\vec{t}$ 。
则观察空间是以相机坐标为原点，x，y，z 轴分别对应 $\vec{g}\times\vec{t},\vec{t},-\vec{g}$ 的局部坐标系
#### 裁剪空间
观察空间经过投影变换后得到的空间。
#### 标准设备坐标 NDC
裁剪空间经过透视除法（除以w）得到 NDC。
NDC 坐标都在 $[-1,1]^3$ 的立方体中。
#### 屏幕空间
屏幕的像素坐标。
#### 切线空间
模型上一点，以其法线（N）、u（T'）、v（B'）进行施密特正交化得到的局部坐标系（TBN）。

### 光照模型

#### Phong 模型
环境光+漫反射+镜面反射
#### Blinn-Phong 模型
环境光+漫反射+镜面反射
在镜面反射的计算上，Blinn-Phong 使用半程向量进行计算。

### 全局光照模型

#### whitted光线追踪

### 抗锯齿/反走样

#### 滤波，高斯模糊

#### 超采样反走样(SSAA)
提高采样率

增加采样点：
![[增加采样点.png]]
增加采样点前：
![[增加采样点前.png]]
增加采样点后：
![[增加采样点后.png]]
采样率提高了 4 倍。
对每一个子采样点，都进行原母采样点的流程，即：判断是否在三角形内、深度检测、着色，得到这个子采样点的颜色。
最终原母采样点的颜色为子采样点颜色的平均：
![[颜色进行平均计算.png]]
#### 多重反走样 MSAA
SSAA 的改进。
SSAA 开销太多，基本上开销的增大等同与采样率增多的倍数。

MSAA 根据母采样点的颜色乘以子采样点的覆盖率得到最终颜色。
省去了对子采样点的大量计算，只需计算覆盖率即可。

#### FXAA (Fast Approximate AA) （很快） 
和增加样本数、采样没有任何关系，它是一个图像的后期处理，就是先把带锯齿的图像做出来，通过图像匹配的方法找到边界，再将这些边界换成没有锯齿的边界。

#### TAA (Temporal AA)
找上一帧的信息，比如还是用像素内的一个点来感知是否在三角形内，假如说我们看到的是一个静止的场景（相邻两帧显示的东西一样），但相邻两帧我可以用一个像素内部不同位置上的点来感知是否在三角形内，大家会发现在时间范围内得到的静态场景的图在边界上会各不相同，有的时候出现边界，有的时候没出现边界，TAA的思想就是复用上一帧的结果，相当于将MSAA对应的样本给分布再在时间上，然后在当前这帧没有引入任何的其他的操作。

### 纹理

#### 环绕方式
纹理坐标的范围通常是从 (0, 0) 到 (1, 1) ，
纹理坐标超出范围时，采取什么行为：重复、镜像、使用边缘、自定义。
#### 过滤方式
纹理坐标到纹理像素（Texel，Texture Pixel）的映射方式。
邻近过滤：离纹理坐标最接近的纹理像素颜色
线性过滤：离纹理坐标最接近的纹理像素的插值颜色
#### Mipmap

问题场景：物体处于远处时， 相邻屏幕像素点对应的纹理坐标在纹理贴图上跨越太大，导致走样。

解决方法：将纹理划分为不同 level （分辨率）的纹理图集，随 level 每提升一级，将 4 个相邻像素按均值合并为 1 个像素

![[Mipmap.png]]
利用相邻屏幕像素点映射到纹理坐标，由此估算出这个屏幕像素点在纹理贴图上的跨度，从而确定使用哪个 level 的纹理贴图。

例如：取该屏幕像素点A的上、右相邻像素点B，C，得到其纹理坐标，计算 A'B'，A'C' 距离的最大值，得到跨度，从而确定 level。
![[计算覆盖面积.png]]

#### 三线性插值
![[三线性插值.png]]
查询 level A 的纹理贴图，双线性插值得到结果
查询 leval A+1 的纹理贴图，双线性插值得到结果
两者查询结果再次进行插值。

#### 各向异性过滤 Mipmap
问题场景：物体处于远处时， 相邻屏幕像素点对应的纹理坐标在纹理贴图上的覆盖图形可能并非接近正方形，而是接近长条形。

解决方法：仍然将纹理划分为不同分辨率的纹理图集，但从 u 轴、v 轴各自将 2 个相邻像素按均值合并为 1 个像素。

![[各向异性过滤Mipmap.png]]

这么一来，估算跨度时，就不取两方向最大值了，而是根据两方向取值来确定使用哪个纹理贴图。

不过仍然只能解决贴近u、v方向的长方形，无法解决斜向的长条形。