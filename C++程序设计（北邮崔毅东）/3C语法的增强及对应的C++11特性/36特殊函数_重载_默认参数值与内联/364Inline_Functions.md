# 364 Inline Functions

内联函数

**普通函数的优缺点**：

优点：易读易维护

缺点：调用时有开销。

函数调用时，参数及部分 CPU 寄存器内容进栈，控制流跳转。
函数返回时，返回值及寄存器值出栈，控制流跳转。

**内联函数的作用**：

目的：减少函数调用开销。

方法：代码插入到调用处。

结果：由于内联函数的代码拷贝了很多份插入到调用处，导致程序体积变大。

以空间换时间。

## Declaration 声明内联函数

在普通函数前加上 inline。

内联函数的声明和定义一般不分开。
虽然能分开，但分开的处理与普通函数不一样。

~~~C++
inline int max(int a, int b){
    return (a>b ? a : b)
}
~~~

## Calling 调用内联函数

与普通函数一致。

~~~C++
int x = max(3,5);
int y = max(0,8);
~~~

## Inline expansion 内联展开

编译器处理内联函数时，进行内联展开，也就是将内联函数代码插入到调用处。

~~~C++
int x = (3>5 ? 3 : 5);
int y = (0>8 ? 0 : 8);
~~~

## Restrictions for inline function 内联函数的使用限制

适用于频繁调用的短函数。
不适用于多处调用的长函数。

内联函数只是一种编译机制。
inline 是对编译器的请求，而不是命令。
大多数编译器并不把带有循环、递归、静态变量等或代码比较多的函数进行内联编译。