# 特殊矩阵的压缩存储

## 一. 数组的定义

......

## 二. 数组的存储结构

对于二维数组 $A=\left[\begin{matrix}a_{00}&a_{01}&a_{02}\\a_{10}&a_{11}&a_{12}\end{matrix}\right]$​ ，

行优先方式存储： $a[0][0],a[0][1],a[0][2],a[1][0],a[1][1],a[1][2]$​ 。

列优先方式存储： $a[0][0],a[1][0],a[0][1],a[1][1],a[0][2],a[1][2]$​ 。

## 三. 矩阵的压缩存储

主对角线：$a_{ij},i=j$ ；

下三角区：$a_{ij},i>j$ ；

上三角区：$a_{ij},i<j$ ；

### 3.1 对称矩阵

对称矩阵： $a_{ij}=a_{ji}$​ 。
假定矩阵元素从 1 开始计数为：
$$
A=\left[\begin{matrix}
a_{11}&a_{12}&...&a_{1n}\\
a_{21}&a_{22}&...&a_{2n}\\
...&...&...&...\\
a_{n1}&a_{n2}&...&a_{nn}
\end{matrix}\right]
$$
使用数组 $B[n(n+1)/2]$ 来存放矩阵 $A$ 下三角区和对角线上的元素。
注意一下矩阵是 $A$ 从 1 开始，数组 $B$ 是从 0 开始。

本质上，就是要实现 $A[i][j]\Rightarrow B[k]$​ ​​​​的转换。

以行优先的方式存储：

当给出的 $a[i][j]$ 为下三角区内的元素时，即 $i>j$ 时，转换关系为：
$$
\begin{aligned}
k&=1+2+3+...+(i-1)+j-1
\\&=\frac{i(i-1)}{2}+j-1
\end{aligned}
$$
当给出的 $a[i][j]$ 为上三角区内的元素时，即 $i<j$​​ 时，只需要保证 $a[i][j]$ 与 $a[j][i]$ 算出的 $k$ 相等，于是需要判断，当 $i<j$ 时，将 $i,j$ 值互换带入转换表达式：
$$
\begin{aligned}
k&=1+2+3+...+(j-1)+i-1
\\&=\frac{j(j-1)}{2}+i-1
\end{aligned}
$$
至于 $i=j$ 用上面两个式子没差别。

总结：
$$
k=
\begin{cases}
\begin{aligned}
\frac{i(i-1)}{2}+j-1&,i\geq j
\\\frac{j(j-1)}{2}+i-1&,i<j
\end{aligned}
\end{cases}
$$

### 3.2 三角矩阵

三角矩阵：上三角区或下三角区的元素全为常数。

下三角矩阵：除了下三角区和主对角线外，上三角区的元素全为常数。
上三角矩阵：除了上三角区和主对角线外，下三角区的元素全为常数。

这里以下三角矩阵为例：
$$
A=\left[\begin{matrix}
a_{11}&C&...&C\\
a_{21}&a_{22}&...&C\\
...&...&...&...\\
a_{n1}&a_{n2}&...&a_{nn}
\end{matrix}\right]
$$
以行优先的方式存储：

转换与对称矩阵类似，无非就是在上三角区时直接返回常数项 C，所以我们将常数项 C 直接存放在最后数组的最后一个，即 $1+...+n-1+1=\frac{n(n+1)}{2}$​ 。
$$
k=
\begin{cases}
\begin{aligned}
&\frac{i(i-1)}{2}+j-1&,i\geq j
\\&\frac{n(n+1)}{2}&,i<j
\end{aligned}
\end{cases}
$$

### 3.3 三对角矩阵

对角矩阵也称带状矩阵。

当 $|i-j|>1$ 时，都有 $a_{ij}=0$ ，则称为三对角矩阵。即除了主对角线元素及其左右距离为 1 的元素外，其它元素都为 0。
$$
A=\left[\begin{matrix}
a_{11}&a_{12}&...&0&0&0\\
a_{21}&a_{22}&a_{23}&...&0&0\\
0&a_{32}&a_{33}&a_{34}&0&0\\
...&...&...&...&...&...\\
0&...&a_{(n-2)(n-3)}&a_{(n-2)(n-2)}&a_{(n-2)(n-1)}&0\\
0&...&0&a_{(n-1)(n-2)}&a_{(n-1)(n-1)}&a_{(n-1)n}\\
0&0&...&0&a_{(n-1)n}&a_{nn}
\end{matrix}\right]
$$
以行优先的方式存储：
$$
\begin{aligned}
k&=\underbrace{3*(i-1)-1}_{\text{前}i-1\text{行元素个数}}+\underbrace{j-(i-2)}_{\text{第}i\text{行}j\text{是第几个}}-\underbrace{1}_{\text{数组}B\text{从}0\text{开始}}
\\&=2i+j-2-1
\\&=2i+j-3
\end{aligned}
$$
反之，若给出 $k$ ，则可推出 $i,j$ 。

因为，给出数组的 $k$​ 实则是矩阵中的第 $k+1$​ 个元素。
所以，这第 $k+1$​ 个元素必然大于前 $i-1$​ 行的元素个数，小于等于前 $i$​ 行的元素个数（可能刚好为第 $i$ 行最后一个）：
$$
\begin{aligned}
\underbrace{3(i-1)-1}_{\text{前}i-1\text{行元素个数}}&<k+1\leq\underbrace{3i-1}_{\text{前}i\text{行元素个数}}
\\3(i-1)&<k+2\leq3i
\\i-1&<\frac{k+2}{3}\leq i
\\\frac{k+1}{3}&\leq i<\frac{k+1}{3}+1
\\\Rightarrow i&=\lceil \frac{k+2}{3}\rceil
\end{aligned}
$$
或者另一种思路，我前面有 $k$​ 个元素，这第 $k$​ 个元素必然大于或等于前 $i-1$​ 行的元素个数（可能刚好为第 $i-1$​ 行最后一个），小于前 $i$​​ 行的元素个数：
$$
\begin{aligned}
\underbrace{3(i-1)-1}_{\text{前}i-1\text{行元素个数}}&\leq k<\underbrace{3i-1}_{\text{前}i\text{行元素个数}}
\\3(i-1)&\leq k+1<3i
\\i-1&\leq\frac{k+1}{3}< i
\\\frac{k+1}{3}&< i\leq\frac{k+1}{3}+1
\\\Rightarrow i&=\lfloor \frac{k+1}{3}+1\rfloor
\end{aligned}
$$


这二者的结果 $i$ 都是一样的，毕竟 $i$​ 只会是整数。
$$
\begin{aligned}
i&=\lfloor \frac{k+1}{3}+1\rfloor\text{或}i=\lceil \frac{k+2}{3}\rceil
\\j&=k-2i+3
\end{aligned}
$$
至于 $j$​ 已知 $i$ 了，则直接由 $k=2i+j-3$ 推出呗。

## 四. 稀疏矩阵

稀疏矩阵：矩阵中非零元素的数量非常少。

例如：
$$
A=\left[\begin{matrix}
4&0&0&0\\
0&0&6&0\\
0&9&0&0\\
0&23&0&0
\end{matrix}\right]
$$
则将非零元素及其 $i,j$ 形成三元组（行号、列号、值）进行存储：

| i    | j    | value |
| ---- | ---- | ----- |
| 0    | 0    | 4     |
| 1    | 2    | 6     |
| 2    | 1    | 9     |
| 3    | 1    | 23    |

当然，这样也就失去了随机存取的特性。

至于三元组，既可使用数组存储，也可使用十字链表法进行存储。

2021.07.29
